---
- name: Setup
  hosts: all
  sudo: true
  vars:
  - run_user: bms
  # erl_app defaults
  - base_data_dir: /var/lib
  - data_dir_suffix: ""
  - base_log_dir: /var/log
  - download_dir: /tmp
  - has_config: false
  - http_proxy: ""
  - name_suffix: ""
  tasks:
  - include: tasks/base.yml
    vars:
        user: "{{run_user}}"

  - include: tasks/erl_app.yml
    vars:
        name: funnel
        name_suffix: _mini
        version: "{{funnel_version}}"
        has_config: true
        data_dir: "{{base_data_dir}}/funnel/{{data_dir_suffix}}"
        log_dir: "{{base_log_dir}}/funnel/"
        user: "{{run_user}}"

  - include: tasks/erl_app.yml
    vars:
        name: soap_srv
        version: "{{soap_version}}"
        has_config: true
        data_dir: "{{base_data_dir}}/soap_srv/{{data_dir_suffix}}"
        log_dir: "{{base_log_dir}}/soap_srv/"
        user: "{{run_user}}"

  - include: tasks/erl_app.yml
    vars:
        name: mm_srv
        version: "{{mm_version}}"
        has_config: true
        data_dir: "{{base_data_dir}}/mm_srv/{{data_dir_suffix}}"
        log_dir: "{{base_log_dir}}/mm_srv/"
        user: "{{run_user}}"

  - include: tasks/erl_app.yml
    vars:
        name: oneapi_srv
        version: "{{oneapi_version}}"
        has_config: true
        data_dir: "{{base_data_dir}}/oneapi_srv/{{data_dir_suffix}}"
        log_dir: "{{base_log_dir}}/oneapi_srv/"
        user: "{{run_user}}"

  - include: tasks/erl_app.yml
    vars:
        name: kelly
        version: "{{kelly_version}}"
        has_config: true
        data_dir: "{{base_data_dir}}/kelly/{{data_dir_suffix}}"
        log_dir: "{{base_log_dir}}/kelly/"
        user: "{{run_user}}"

  - include: tasks/erl_app.yml
    vars:
        name: just
        name_suffix: _mini
        version: "{{just_version}}"
        has_config: true
        data_dir: "{{base_data_dir}}/just/{{data_dir_suffix}}"
        log_dir: "{{base_log_dir}}/just/"
        user: "{{run_user}}"

  - include: tasks/erl_app.yml
    vars:
        name: smppsink
        version: "{{smppsink_version}}"
        has_config: true
        user: "{{run_user}}"
