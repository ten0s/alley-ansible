<cluster config_version="23" name="<%= node["platform_name"] %><% if node["cluster"]["number"] != "1" %>_<%= node["cluster"]["role"] %><% end %>">
  <fence_daemon/>
  <clusternodes>
<% i = 1 %>
<% if node["cluster"]["number"] == "1" || node["cluster"]["role"] == "front" %>
<% node["hosts"]["node"]["front"].keys.each do |front_host| %>
    <clusternode name="<%= "#{front_host}" %>" nodeid="<%= "#{i}" %>">
      <fence>
        <method name="pcmk-redirect">
          <device name="pcmk" port="<%= "#{front_host}" %>"/>
        </method>
      </fence>
    </clusternode>
<% i = i + 1%>
<% end %>
<% end %>
<% if node["cluster"]["number"] == "1" || node["cluster"]["role"] == "back" %>
<% node["hosts"]["node"]["back"].keys.each do |back_host| %>
    <clusternode name="<%= "#{back_host}" %>" nodeid="<%= "#{i}" %>">
      <fence>
        <method name="pcmk-redirect">
          <device name="pcmk" port="<%= "#{back_host}" %>"/>
        </method>
      </fence>
    </clusternode>
<% i = i + 1 %>
<% end %>
<% end %>
  </clusternodes>
  <cman transport="udpu"/>
  <fencedevices>
    <fencedevice agent="fence_pcmk" name="pcmk"/>
  </fencedevices>
  <rm>
    <failoverdomains/>
    <resources/>
  </rm>
</cluster>
