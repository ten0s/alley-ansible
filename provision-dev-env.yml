---
- name: Provision PowerAlley dev env
  hosts: all
  sudo: true
  roles:
  - {role: common, tags: ["common"]}
  # backend env
  - {role: erlang, tags: ["erlang"]}
  - {role: rabbitmq, tags: ["rabbitmq"]}
  - {role: mongodb, tags: ["mongodb"]}
  - {role: smppsim, tags: ["smppsim"]}
  - {role: smppsink,   tags: ["smppsink"]}
  # frontenv env
  - {role: mono, tags: ["mono"]}
  - {role: mysql, tags: ["mysql"]}
  - {role: nginx, tags: ["nginx"]}
  - {role: supervisor, tags: ["supervisor"]}
  # ui
  - {role: poweralleyui, tags: ["poweralleyui"]}

  tasks:
  - name: Set hostname
    hostname: name=dev
    tags: ["common"]

  - name: Copy start dev env script
    copy: src=files/start-dev-env
          dest=/opt/bin/
          mode=755

  - name: Setup autostart
    lineinfile: dest=/etc/rc.local
                line="su {{run_user}} -l -c 'bash -c \"/opt/bin/start-dev-env &>> /home/{{run_user}}/start-dev-alley.log\"'"
    tags: ["autostart"]
